<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Branded QR Code Generator</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Inter Font -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7f7fa;
        }
        /* Custom styles for the QR code container */
        #qr-container {
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
            width: 300px;
            height: 300px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
            overflow: hidden;
        }
        canvas {
            max-width: 100% !important;
            height: auto !important;
        }
        .file-upload-label {
            transition: background-color 0.15s ease, border-color 0.15s ease;
            cursor: pointer;
        }
        .file-upload-label:hover {
            background-color: #e5e7eb;
        }
    </style>
</head>
<body>

    <div class="min-h-screen p-4 flex flex-col items-center justify-center">
        <header class="text-center mb-10 w-full max-w-xl">
            <h1 class="text-4xl font-extrabold text-gray-900 mb-2">Branded QR Code Generator</h1>
            <p class="text-lg text-gray-500">Create shareable QR codes with custom styles and logos.</p>
        </header>

        <main class="w-full max-w-5xl bg-white p-6 md:p-10 rounded-xl shadow-2xl grid grid-cols-1 lg:grid-cols-2 gap-8">

            <!-- Control Panel -->
            <div class="space-y-6 overflow-y-auto max-h-[70vh] pr-2 custom-scrollbar">
                <h2 class="text-2xl font-semibold text-gray-800 border-b pb-3 mb-4">Settings</h2>

                <!-- 1. URL Input -->
                <div>
                    <label for="url-input" class="block text-sm font-medium text-gray-700 mb-1">Link to Encode</label>
                    <input type="url" id="url-input" value="https://www.google.com" placeholder="e.g., https://www.yourwebsite.com"
                           class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 transition duration-150">
                </div>

                <!-- 2. QR Style Selection -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">QR Body Style</label>
                    <div class="flex flex-wrap gap-4">
                        <label class="inline-flex items-center">
                            <input type="radio" name="qr-style" value="square" checked class="form-radio text-blue-600 h-4 w-4" >
                            <span class="ml-2 text-sm text-gray-700">Square</span>
                        </label>
                        <label class="inline-flex items-center">
                            <input type="radio" name="qr-style" value="dots" class="form-radio text-blue-600 h-4 w-4" >
                            <span class="ml-2 text-sm text-gray-700">Dots</span>
                        </label>
                        <label class="inline-flex items-center">
                            <input type="radio" name="qr-style" value="rounded" class="form-radio text-blue-600 h-4 w-4" >
                            <span class="ml-2 text-sm text-gray-700">Rounded</span>
                        </label>
                    </div>
                </div>

                <!-- 3. Logo Upload -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Custom Center Logo (Optional)</label>
                    <div class="flex items-center space-x-4">
                        <label for="logo-upload" class="file-upload-label px-4 py-2 border border-gray-300 bg-gray-50 rounded-lg text-sm font-medium text-gray-700 hover:bg-gray-100 transition duration-150">
                            Choose Image
                            <input type="file" id="logo-upload" accept="image/*" class="hidden">
                        </label>
                        <button id="remove-logo" class="px-3 py-2 text-sm font-medium text-red-600 bg-red-50 hover:bg-red-100 rounded-lg border border-red-200 transition duration-150 hidden" onclick="removeLogo()">
                            Remove Logo
                        </button>
                    </div>
                    <p id="file-name" class="mt-2 text-xs text-gray-500">No file selected.</p>
                </div>

                <!-- 4. Pre-defined Logos -->
                <div id="predefined-logo-control">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Use Pre-defined Logo</label>
                    <div id="logo-selection-grid" class="flex flex-wrap gap-3 p-3 bg-gray-50 rounded-lg border border-gray-200">
                        <!-- Icons will be generated here by JavaScript -->
                    </div>
                    <button id="clear-predefined-logo" class="mt-2 px-3 py-1 text-xs font-medium text-gray-600 bg-white hover:bg-gray-100 rounded-lg border border-gray-300 transition duration-150 hidden">Clear Pre-defined Selection</button>
                </div>
                
                <!-- 5. Logo Size Input -->
                <div id="logo-size-control">
                    <label for="logo-size" class="block text-sm font-medium text-gray-700 mb-1">Logo Size (% of QR Code)</label>
                    <input type="number" id="logo-size" value="25" min="10" max="35" 
                           class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 transition duration-150">
                    <p class="mt-2 text-xs text-gray-500">Max recommended size is 35% (requires High error correction level).</p>
                </div>

                <!-- 6. Logo Style/Border -->
                <div id="logo-style-control">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Logo Background Style</label>
                    <div class="flex flex-wrap gap-4">
                        <label class="inline-flex items-center">
                            <input type="radio" name="logo-style" value="rounded" checked class="form-radio text-blue-600 h-4 w-4" >
                            <span class="ml-2 text-sm text-gray-700">Rounded Square</span>
                        </label>
                        <label class="inline-flex items-center">
                            <input type="radio" name="logo-style" value="circle" class="form-radio text-blue-600 h-4 w-4" >
                            <span class="ml-2 text-sm text-gray-700">Circle</span>
                        </label>
                        <label class="inline-flex items-center">
                            <input type="radio" name="logo-style" value="none" class="form-radio text-blue-600 h-4 w-4" >
                            <span class="ml-2 text-sm text-gray-700">None</span>
                        </label>
                    </div>
                </div>

                <!-- 7. QR Options (Color) -->
                <div class="flex space-x-4">
                    <div>
                        <label for="color-dark" class="block text-sm font-medium text-gray-700 mb-1">QR Color</label>
                        <input type="color" id="color-dark" value="#000000" class="h-10 w-24 border border-gray-300 rounded-lg p-1">
                    </div>
                    <div>
                        <label for="color-light" class="block text-sm font-medium text-gray-700 mb-1">Background</label>
                        <input type="color" id="color-light" value="#ffffff" class="h-10 w-24 border border-gray-300 rounded-lg p-1">
                    </div>
                </div>

                <!-- 8. Error Correction Level Selector -->
                <div>
                    <label for="level-select" class="block text-sm font-medium text-gray-700 mb-1">Error Correction Level</label>
                    <select id="level-select" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 transition duration-150">
                        <option value="H" data-tolerance="30%">H (High - 30% Damage Tolerance)</option>
                        <option value="Q" data-tolerance="25%">Q (Quartile - 25% Damage Tolerance)</option>
                        <option value="M" data-tolerance="15%">M (Medium - 15% Damage Tolerance)</option>
                        <option value="L" data-tolerance="7%">L (Low - 7% Damage Tolerance)</option>
                    </select>
                </div>
                
                <!-- 9. Generate Button -->
                <button id="generate-button"
                        class="w-full px-6 py-3 bg-blue-600 text-white font-semibold rounded-xl shadow-md hover:bg-blue-700 transition duration-150 ease-in-out transform hover:scale-[1.01]">
                    Generate QR Code
                </button>
            </div>

            <!-- Preview and Download -->
            <div class="flex flex-col items-center justify-start space-y-6 lg:border-l lg:pl-8">
                <h2 class="text-2xl font-semibold text-gray-800 border-b pb-3 mb-4 w-full">Preview</h2>

                <!-- QR Code Container -->
                <div id="qr-container">
                    <div id="qr-render"></div>
                </div>

                <!-- Download Button -->
                <button id="download-button"
                        class="w-full max-w-xs px-6 py-3 bg-green-500 text-white font-semibold rounded-xl shadow-md hover:bg-green-600 disabled:bg-gray-400 transition duration-150 ease-in-out">
                    Download High-Res PNG
                </button>

                <!-- Status Message -->
                <div id="status-message" class="text-sm text-gray-600 mt-4 h-5"></div>
            </div>

        </main>
        
        <!-- Footer Credit -->
        <footer class="text-center mt-6 pb-4 text-sm text-gray-500">
            Designed by <span class="font-semibold text-gray-700">Robinraj Premchand</span>
        </footer>
    </div>

    <!-- qr-code-styling library -->
    <script type="text/javascript" src="https://unpkg.com/qr-code-styling@1.5.0/lib/qr-code-styling.js"></script>

    <script>
        const urlInput = document.getElementById('url-input');
        const logoUpload = document.getElementById('logo-upload');
        const removeLogoBtn = document.getElementById('remove-logo');
        const colorDarkInput = document.getElementById('color-dark');
        const colorLightInput = document.getElementById('color-light');
        const generateButton = document.getElementById('generate-button');
        const downloadButton = document.getElementById('download-button');
        const qrRenderContainer = document.getElementById('qr-render');
        const statusMessage = document.getElementById('status-message');
        const fileNameDisplay = document.getElementById('file-name');
        
        const levelSelect = document.getElementById('level-select');
        const logoSizeInput = document.getElementById('logo-size');
        const logoStyleInputs = document.querySelectorAll('input[name="logo-style"]');
        const qrStyleInputs = document.querySelectorAll('input[name="qr-style"]');

        let qrCode = null; 
        let currentLogoDataURL = null;
        
        const PREVIEW_SIZE = 300;

        const createSvgDataUrl = (svgContent) => {
            const svg = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">${svgContent}</svg>`;
            return `data:image/svg+xml;base64,${btoa(svg)}`;
        };

        const LOGO_SVGS = {
            'whatsapp': createSvgDataUrl('<path fill="#4FCE5D" d="M12 0a12 12 0 0 0-9.6 19.3L1 23l4-1.2A11.9 11.9 0 0 0 12 24h.1a12 12 0 0 0 12-12 12 12 0 0 0-12-12zm6.6 14.1c-.2.5-.5.7-.9.8-.3.1-.9.2-1.4-.2-.5-.4-1.6-1-1.9-1-.3 0-.6 0-.8.2-.2.2-.8.8-.9.9s-.4.2-.7.2c-.3 0-.9-.3-1.6-.9-.6-.6-1.1-1.4-1.5-2.2-.4-.8-.1-1.3 0-1.4.1-.1.2-.3.3-.4.1-.1.2-.2.3-.4.1-.2 0-.4 0-.5 0-.1-.4-.8-.6-1-.2-.2-.5-.1-.7-.1-.2 0-.4 0-.6 0c-.2 0-.6.1-.9.5-.3.4-1.1 1.1-1.1 2.7 0 1.6 1.1 3.1 1.2 3.2.1.2 2.1 3.5 5.3 4.8 3.3 1.2 3.3 1.2 3.9 1.2.6 0 1.9-.7 2.2-1.5.3-.9.3-1.5.2-1.7-.1-.2-.3-.3-.6-.4z"/>'),
            'instagram': createSvgDataUrl('<rect width="24" height="24" rx="6" fill="#D62976"/><circle cx="12" cy="12" r="4.5" fill="none" stroke="white" stroke-width="2.5"/><circle cx="12" cy="12" r="2.5" fill="white"/><circle cx="18" cy="6" r="1.5" fill="white"/>'),
            'facebook': createSvgDataUrl('<rect width="24" height="24" rx="4" fill="#3B5998"/><path fill="white" d="M14 10h3l-1 5h-2v9h-5v-9H6v-5h3V8c0-1.7 1-3 3-3h3v5z"/>'),
            'youtube': createSvgDataUrl('<rect width="24" height="24" rx="4" fill="#FF0000"/><path fill="white" d="M12 4a8 8 0 1 0 0 16 8 8 0 0 0 0-16zM9.5 16.5l6-4.5-6-4.5v9z"/>'),
            'x-twitter': createSvgDataUrl('<rect width="24" height="24" fill="#000000"/><path fill="white" d="M18.244 2.25h3.308l-7.227 8.256L21.6 21.75h-5.267L8.953 14.185 3.49 21.75H.97l7.865-8.877L.125 2.25h5.304l5.008 6.095L18.244 2.25z"/>'),
            'website': createSvgDataUrl('<circle cx="12" cy="12" r="10" fill="none" stroke="#4B5563" stroke-width="2"/><ellipse cx="12" cy="12" rx="10" ry="4" fill="none" stroke="#4B5563" stroke-width="2"/><path fill="none" stroke="#4B5563" stroke-width="2" d="M2 12h20M12 2v20"/>')
        };

        // --- Helper: Apply Shape to Logo ---
        async function getStyledLogo(base64, shape, bgColor) {
            if (shape === 'none' || !base64) return base64;

            return new Promise((resolve) => {
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                const img = new Image();

                img.onload = () => {
                    const size = 512; // High-res internal processing
                    canvas.width = size;
                    canvas.height = size;

                    // 1. Draw Background Shape
                    ctx.fillStyle = bgColor;
                    if (shape === 'circle') {
                        ctx.beginPath();
                        ctx.arc(size/2, size/2, size/2, 0, Math.PI * 2);
                        ctx.fill();
                    } else if (shape === 'rounded') {
                        const radius = 80;
                        ctx.beginPath();
                        ctx.roundRect(0, 0, size, size, radius);
                        ctx.fill();
                    }

                    // 2. Draw Logo (centered with padding)
                    const padding = size * 0.15;
                    const drawSize = size - (padding * 2);
                    
                    // Maintain aspect ratio
                    const ratio = img.width / img.height;
                    let w = drawSize, h = drawSize;
                    if (ratio > 1) h = drawSize / ratio;
                    else w = drawSize * ratio;

                    ctx.drawImage(img, (size-w)/2, (size-h)/2, w, h);
                    resolve(canvas.toDataURL('image/png'));
                };
                img.src = base64;
            });
        }

        async function generateQRCode() {
            const qrStyle = document.querySelector('input[name="qr-style"]:checked').value;
            const logoBg = document.querySelector('input[name="logo-style"]:checked').value;
            const sizeFactor = parseInt(logoSizeInput.value, 10) / 100;
            const bgColor = colorLightInput.value;
            const dotColor = colorDarkInput.value;

            qrRenderContainer.innerHTML = '';
            
            // Apply requested shape to the logo data
            const finalLogo = await getStyledLogo(currentLogoDataURL, logoBg, bgColor);

            const cornerType = qrStyle === 'dots' ? 'dot' : (qrStyle === 'rounded' ? 'extra-rounded' : 'square');

            const options = {
                width: PREVIEW_SIZE,
                height: PREVIEW_SIZE,
                type: "canvas",
                data: urlInput.value || "https://www.google.com",
                image: finalLogo,
                dotsOptions: {
                    color: dotColor,
                    type: qrStyle === 'rounded' ? 'rounded' : (qrStyle === 'dots' ? 'dots' : 'square')
                },
                backgroundOptions: {
                    color: bgColor,
                },
                imageOptions: {
                    crossOrigin: "anonymous",
                    margin: logoBg === 'none' ? 0 : 4,
                    imageSize: sizeFactor,
                    hideBackgroundDots: true
                },
                qrOptions: {
                    errorCorrectionLevel: levelSelect.value
                },
                cornersSquareOptions: {
                    type: cornerType,
                    color: dotColor
                },
                cornersDotOptions: {
                    type: cornerType === 'dot' ? 'dot' : 'square',
                    color: dotColor
                }
            };

            qrCode = new QRCodeStyling(options);
            qrCode.append(qrRenderContainer);
            statusMessage.textContent = 'QR Code generated!';
        }

        function renderLogoSelectionGrid() {
            const container = document.getElementById('logo-selection-grid');
            const clearButton = document.getElementById('clear-predefined-logo');
            container.innerHTML = '';
            
            Object.keys(LOGO_SVGS).forEach(key => {
                const dataUrl = LOGO_SVGS[key];
                const div = document.createElement('div');
                div.className = 'flex flex-col items-center p-2 rounded-lg cursor-pointer hover:bg-white transition duration-150 border-2 border-transparent';
                
                const img = document.createElement('img');
                img.src = dataUrl;
                img.className = 'w-8 h-8 pointer-events-none';

                const span = document.createElement('span');
                span.className = 'text-[10px] text-gray-700 mt-1 capitalize pointer-events-none';
                span.textContent = key.replace('-', ' ');

                div.appendChild(img);
                div.appendChild(span);
                container.appendChild(div);

                div.addEventListener('click', () => {
                    currentLogoDataURL = dataUrl;
                    logoUpload.value = '';
                    fileNameDisplay.textContent = `Pre-defined: ${key}`;
                    removeLogoBtn.classList.remove('hidden');
                    clearButton.classList.remove('hidden');
                    document.querySelectorAll('#logo-selection-grid > div').forEach(d => d.classList.remove('border-blue-500', 'bg-white'));
                    div.classList.add('border-blue-500', 'bg-white');
                    generateQRCode();
                });
            });
            
            clearButton.addEventListener('click', removeLogo);
        }

        function removeLogo() {
            currentLogoDataURL = null;
            logoUpload.value = '';
            fileNameDisplay.textContent = 'No file selected.';
            removeLogoBtn.classList.add('hidden');
            document.getElementById('clear-predefined-logo').classList.add('hidden');
            document.querySelectorAll('#logo-selection-grid > div').forEach(d => d.classList.remove('border-blue-500', 'bg-white'));
            generateQRCode();
        }

        async function downloadQRCode() {
            if (!qrCode) return;
            const urlValue = urlInput.value.replace(/^(https?:\/\/)?(www\.)?/, '').replace(/\//g, '_').substring(0, 20);
            
            // High-res export requires updating the instance temporarily
            qrCode.download({
                name: `QR-${urlValue || 'code'}`,
                extension: "png"
            });
        }
        
        logoUpload.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (event) => {
                    currentLogoDataURL = event.target.result;
                    fileNameDisplay.textContent = file.name;
                    removeLogoBtn.classList.remove('hidden');
                    document.querySelectorAll('#logo-selection-grid > div').forEach(d => d.classList.remove('border-blue-500', 'bg-white'));
                    generateQRCode();
                };
                reader.readAsDataURL(file);
            }
        });

        window.onload = () => {
            renderLogoSelectionGrid();
            generateQRCode(); 
            generateButton.addEventListener('click', generateQRCode);
            downloadButton.addEventListener('click', downloadQRCode);
            urlInput.addEventListener('input', generateQRCode);
            colorDarkInput.addEventListener('input', generateQRCode);
            colorLightInput.addEventListener('input', generateQRCode);
            logoSizeInput.addEventListener('input', generateQRCode);
            logoStyleInputs.forEach(input => input.addEventListener('change', generateQRCode));
            qrStyleInputs.forEach(input => input.addEventListener('change', generateQRCode));
            levelSelect.addEventListener('change', generateQRCode);
        };
    </script>
</body>
</html>